---
# This playbook deploys a kubernetes cluster

- hosts: all
  gather_facts: false
  become: yes
  roles:
    - pre-ansible
  tags:
    - pre-ansible

# Install etcd
#- include: deploy-etcd.yml

# Install docker
- include: deploy-docker.yml

# install flannel
- hosts:
    - masters
    - nodes
  become: yes
  roles:
#    - { role: etcd-certs, when: flannel_etcd_use_certs|default(false) }
    - { role: flannel, when: networking == 'flannel' }
  tags:
    - network-service-install

# install kube master services
- include: deploy-master.yml

# launch addons, like dns
#- include: deploy-addons.yml

# install kubernetes on the nodes
- include: deploy-node.yml

